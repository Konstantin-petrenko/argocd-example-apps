apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: success-rate
spec:
  args:
  - name: application-name
  metrics:
  - name: success-rate
    failureLimit: 3
    failureCondition: result[0] >= 10
    successCondition: result.successRate >= 0.95
    provider:
      newRelic:
        profile: newrelic-v2  # optional, defaults to 'newrelic'
        query: |
          FROM Transaction SELECT percentage(count(*), WHERE httpResponseCode != 500) as successRate where appName = 'api-events'